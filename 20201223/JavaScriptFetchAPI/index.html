<!DOCTYPE html>
<html lang="zh-CN">

  <head>
  <meta charset="utf-8">
  <meta name="author" content="zchengsite, 1451426471@qq.com" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  
  <title>How To Use the JavaScript Fetch API to Get Data   | Macshion</title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">


  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  

<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Macshion" type="application/atom+xml">
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Macshion</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Links</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->



  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">How To Use the JavaScript Fetch API to Get Data</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="Update time"></i>
          2020-12-23
        </span>
        
              <span class="post-tags">
                <i class="iconfont icon-tags" title="Tags"></i>
                
                <span class="span--tag">
                  <a href="/tags/Javascript/" title="Javascript">
                    <b>#</b> Javascript
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Fetch/" title="Fetch">
                    <b>#</b> Fetch
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/English/" title="English">
                    <b>#</b> English
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>There was a time when <code>XMLHttpRequest</code> was used to make API requests. It didn’t include promises, and it didn’t make for clean JavaScript code. Using jQuery, you used the cleaner syntax with <code>jQuery.ajax()</code>.</p>
<p>Now, JavaScript has its own built-in way to make API requests. This is the Fetch API, a new standard to make server requests with promises, but includes many other features.</p>
<p>In this tutorial, you will create both GET and POST requests using the Fetch API.</p>
<a id="more"></a>

<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>To complete this tutorial, you will need the following:</p>
<ul>
<li>The latest version of Node installed on your machine. To install Node on macOS, follow the steps outlined in this <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-node-js-and-create-a-local-development-environment-on-macos">How to Install Node.js and Create a Local Development Environment on macOS</a> tutorial.</li>
<li>A basic understanding of coding in JavaScript, which you can learn more about from the <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorial_series/how-to-code-in-javascript">How to Code in JavaScript</a> series.</li>
<li>An understanding of promises in JavaScript. Read the <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/understanding-the-event-loop-callbacks-promises-and-async-await-in-javascript#promises">Promises section</a> of this article on <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/understanding-the-event-loop-callbacks-promises-and-async-await-in-javascript">the event loop, callbacks, promises, and async/await</a> in JavaScript.</li>
</ul>
<h2 id="Step-1-—-Getting-Started-with-Fetch-API-Syntax"><a href="#Step-1-—-Getting-Started-with-Fetch-API-Syntax" class="headerlink" title="Step 1 — Getting Started with Fetch API Syntax"></a>Step 1 — Getting Started with Fetch API Syntax</h2><p>To use the Fetch API, call the <code>fetch</code> method, which accepts the URL of the API as a parameter:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(url)</span><br></pre></td></tr></table></figure>

<p>After the <code>fetch()</code> method, include the promise method <code>then()</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>The <code>fetch()</code> method returns a promise. If the promise returned is <code>resolve</code>, the function within the <code>then()</code> method is executed. That function contains the code for handling the data received from the API.</p>
<p>Below the <code>then()</code> method, include the <code>catch()</code> method:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.catch(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The API you call using <code>fetch()</code> may be down or other errors may occur. If this happens, the <code>reject</code> promise will be returned. The <code>catch</code> method is used to handle <code>reject</code>. The code within <code>catch()</code> will be executed if an error occurs when calling the API of your choice.</p>
<p>To summarize, using the Fetch API will look like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fetch(url)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>With an understanding of the syntax for using the Fetch API, you can now move on to using <code>fetch()</code> on a real API.</p>
<h2 id="Step-2-—-Using-Fetch-to-get-Data-from-an-API"><a href="#Step-2-—-Using-Fetch-to-get-Data-from-an-API" class="headerlink" title="Step 2 — Using Fetch to get Data from an API"></a>Step 2 — Using Fetch to get Data from an API</h2><p>The following code samples will be based on the <a target="_blank" rel="noopener" href="https://randomuser.me/">Random User API</a>. Using the API, you will get ten users and display them on the page using Vanilla JavaScript.</p>
<p>The idea is to get all the data from the Random User API and display it in list items inside the author’s list. Begin by creating an HTML file and adding a heading and unordered list with the <code>id</code> of <code>authors</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Authors<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;authors&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Now add <code>script</code> tags to the bottom of your HTML file and use a DOM selector to grab the <code>ul</code>. Use <code>getElementById</code> with <code>authors</code> as the argument. Remember, <code>authors</code> is the <code>id</code> for the previously created <code>ul</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;authors&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Create a constant variable called <code>url</code> which will hold the API URL that will return ten random users:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="string">&#x27;https://randomuser.me/api/?results=10&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>With <code>ul</code> and <code>url</code> in place, it’s time to create the functions that will be used to create the list items. Create a function called <code>createNode</code> that takes a parameter called <code>element</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createNode</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Later, when <code>createNode</code> is called, you will need to pass the name of an actual HTML element to create.</p>
<p>Within the function, add a <code>return</code> statement that returns <code>element</code> using <code>document.createElement()</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createNode</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.createElement(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You will also need to create a function called <code>append</code> that takes two parameters: <code>parent</code> and <code>el</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">parent, el</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This function will append <code>el</code> to <code>parent</code> using <code>document.createElement</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">parent, el</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> parent.appendChild(el);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Both <code>createNode</code> and <code>append</code> are ready to go. Now using the Fetch API, call the Random User API using <code>fetch()</code> with <code>url</code> as the argument:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(url)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fetch(url)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>In the code above, you are calling the Fetch API and passing in the URL to the Random User API. Then a response is received. However, the response you get is not JSON, but an object with a series of methods that can be used depending on what you want to do with the information. To convert the object returned into JSON, use the <code>json()</code> method.</p>
<p>Add the <code>then()</code> method which will contain a function with a parameter called <code>resp</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fetch(url)</span><br><span class="line">.then(<span class="function">(<span class="params">resp</span>) =&gt;</span> )</span><br></pre></td></tr></table></figure>

<p>The <code>resp</code> parameter takes the value of the object returned from <code>fetch(url)</code>. Use the <code>json()</code> method to convert <code>resp</code> into JSON data:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fetch(url)</span><br><span class="line">.then(<span class="function">(<span class="params">resp</span>) =&gt;</span> resp.json())</span><br></pre></td></tr></table></figure>

<p>The JSON data still needs to be processed. Add another <code>then()</code> statement with a function that has an argument called <code>data</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Within this function, create a variable called <code>authors</code> that is set equal to <code>data.results</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> authors = data.results;</span><br></pre></td></tr></table></figure>

<p>For each author in <code>authors</code>, you will want to create a list item that displays a picture of them and displays their name. The <code>map()</code> method is great for this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> authors = data.results;</span><br><span class="line"><span class="keyword">return</span> authors.map(<span class="function"><span class="keyword">function</span>(<span class="params">author</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Within your <code>map</code> function, create a variable called <code>li</code> that will be set equal to <code>createNode</code> with <code>li</code> (the HTML element) as the argument:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> authors.map(<span class="function"><span class="keyword">function</span>(<span class="params">author</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> li = createNode(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Repeat this to create a <code>span</code> element and an <code>img</code> element:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> li = createNode(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> img = createNode(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> span = createNode(<span class="string">&#x27;span&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>The API offers a name for the author and a picture that goes along with the name. Set the <code>img.src</code> to the author picture:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> img = createNode(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> span = createNode(<span class="string">&#x27;span&#x27;</span>);</span><br><span class="line"></span><br><span class="line">img.src = author.picture.medium;</span><br></pre></td></tr></table></figure>

<p>The <code>span</code> element should contain the the first and last name of the <code>author</code>. The <code>innerHTML</code> property and string interpolation will allow you to do this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">img.src = author.picture.medium;</span><br><span class="line">span.innerHTML = <span class="string">`<span class="subst">$&#123;author.name.first&#125;</span> <span class="subst">$&#123;author.name.last&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>

<p>With the image and list element created along with the <code>span</code> element, you can use the <code>append</code> function that was previously created to display these elements on the page:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">append(li, img);</span><br><span class="line">append(li, span);</span><br><span class="line">append(ul, li);</span><br></pre></td></tr></table></figure>

<p>With both <code>then()</code> functions completed, you can now add the <code>catch()</code> function. This function will log the potential error to the console:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>This is the full code of the request you created:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createNode</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.createElement(element);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">parent, el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> parent.appendChild(el);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;authors&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">&#x27;https://randomuser.me/api/?results=10&#x27;</span>;</span><br><span class="line"></span><br><span class="line">fetch(url)</span><br><span class="line">.then(<span class="function">(<span class="params">resp</span>) =&gt;</span> resp.json())</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> authors = data.results;</span><br><span class="line">  <span class="keyword">return</span> authors.map(<span class="function"><span class="keyword">function</span>(<span class="params">author</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> li = createNode(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> img = createNode(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> span = createNode(<span class="string">&#x27;span&#x27;</span>);</span><br><span class="line">    img.src = author.picture.medium;</span><br><span class="line">    span.innerHTML = <span class="string">`<span class="subst">$&#123;author.name.first&#125;</span> <span class="subst">$&#123;author.name.last&#125;</span>`</span>;</span><br><span class="line">    append(li, img);</span><br><span class="line">    append(li, span);</span><br><span class="line">    append(ul, li);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>You just successfully performed a GET request using the Random User API and the Fetch API. In the next step, you will learn how to perform POST requests.</p>
<h2 id="Step-3-—-Handling-POST-Requests"><a href="#Step-3-—-Handling-POST-Requests" class="headerlink" title="Step 3 — Handling POST Requests"></a>Step 3 — Handling POST Requests</h2><p>Fetch defaults to GET requests, but you can use all other types of requests, change the headers, and send data. To do this, you need to set your object and pass it as the second argument of the fetch function.</p>
<p>Before creating a POST request, create the data you would like to send to the API. This will be an object called <code>data</code> with the key <code>name</code> and value <code>Sammy</code> (or your name):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="string">&#x27;https://randomuser.me/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">  name: <span class="string">&#x27;Sammy&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Make sure to include a constant variable that holds the link the Random User API.</p>
<p>Since this is a POST request, you will need to state that explicitly. Create an object called <code>fetchData</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fetchData = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This object needs to include three keys: <code>method</code>, <code>body</code>, and <code>headers</code>. The <code>method</code> key should have the value <code>&#39;POST&#39;</code>. <code>body</code> should be set equal to the <code>data</code> object that was just created. <code>headers</code> should have the value of <code>new Headers()</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fetchData = &#123;</span><br><span class="line">  method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  body: data,</span><br><span class="line">  headers: <span class="keyword">new</span> Headers()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>Headers</code> interface is a property of the Fetch API, which allows you to perform various actions on HTTP request and response headers. If you would like to learn more about this, this article called <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/nodejs-express-routing">How To Define Routes and HTTP Request Methods in Express</a> can give you more information.</p>
<p>With this code in place, the POST request can be made using the Fetch API. You will include <code>url</code> and <code>fetchData</code> as arguments for your <code>fetch</code> POST request:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(url, fetchData)</span><br></pre></td></tr></table></figure>

<p>The <code>then()</code> function will include code that handles the response received from the Random User API server:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fetch(url, fetchData)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Handle response you get from the server</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>To create an object and use the <code>fetch()</code> function , there is also another option. Instead of creating an object like <code>fetchData</code>, you can use the request constructor to create your request object. To do this, create a variable called <code>request</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="string">&#x27;https://randomuser.me/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">  name: <span class="string">&#x27;Sara&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> request =</span><br></pre></td></tr></table></figure>

<p>The <code>request</code> variable should be set equal to <code>new Request</code>. The <code>new Request</code> construct takes two arguments: the API url (<code>url</code>) and an object. The object should also include the <code>method</code>, <code>body</code>, and <code>headers</code> keys just like <code>fetchData</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> Request(url, &#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    body: data,</span><br><span class="line">    headers: <span class="keyword">new</span> Headers()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Now, <code>request</code> can be used as the sole argument for <code>fetch()</code> since it also includes the API url:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fetch(request)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Handle response we get from the API</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Altogether, your code will look like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="string">&#x27;https://randomuser.me/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">  name: <span class="string">&#x27;Sara&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> Request(url, &#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    body: data,</span><br><span class="line">    headers: <span class="keyword">new</span> Headers()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fetch(request)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Handle response we get from the API</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Now you know two methods for creating and executing POST requests with the Fetch API.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>While the Fetch API is not yet supported by all the browsers, it is a great alternative to XMLHttpRequest. If you would like to learn how to call Web APIs using React, <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-call-web-apis-with-the-useeffect-hook-in-react">check out this article</a> on this very topic.</p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/20201222/Typescript-type-and-interface/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="Update time"></i>
              2020-12-23
            </span>
            
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="Tags"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/Javascript/" title="Javascript">
                        <b>#</b> Javascript
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Fetch/" title="Fetch">
                        <b>#</b> Fetch
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/English/" title="English">
                        <b>#</b> English
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/20201225/LearnhowGatsbyworks/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div class="post-catalog" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction"><span class="toc-text">Introduction</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Prerequisites"><span class="toc-text">Prerequisites</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-1-%E2%80%94-Getting-Started-with-Fetch-API-Syntax"><span class="toc-text">Step 1 — Getting Started with Fetch API Syntax</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-2-%E2%80%94-Using-Fetch-to-get-Data-from-an-API"><span class="toc-text">Step 2 — Using Fetch to get Data from an API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-3-%E2%80%94-Handling-POST-Requests"><span class="toc-text">Step 3 — Handling POST Requests</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-text">Conclusion</span></a>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        





      </div>
    
  </div>


        <div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/macshion">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="twitter" target="_blank" rel="noopener" href="https://twitter.com/_Macshion">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
      
        <li>
          <a title="weibo" target="_blank" rel="noopener" href="https://weibo.com/1909056972">
            <i class="iconfont icon-weibo"></i>
          </a>
        </li>
      
        <li>
          <a title="rss" href="/atom.xml">
            <i class="iconfont icon-rss"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    <div class="footer-more">
      
        <a href="https://macshion.github.io/">Copyright © Macshion 2019+</a>
        
    </div>
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



      
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




    </div>
  </body>
</html>
